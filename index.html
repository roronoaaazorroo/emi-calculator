<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EMI Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#f3f4f6;
  --card:#fff;
  --accent:#0f62fe;
  --muted:#555;
  --radius:14px;
  --shadow:0 6px 18px rgba(0,0,0,.08);
  font-family:Arial, sans-serif;
}
body{margin:0;background:var(--bg);}
.container{max-width:900px;margin:20px auto;padding:16px;}
h1{text-align:center;}
.card,.adv-box{
  background:var(--card);
  padding:16px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  margin-bottom:18px;
}
.form-row{margin-bottom:12px;}
label{font-size:13px;color:var(--muted);}
input,select{
  width:100%;padding:10px;
  border-radius:10px;border:1px solid #ccc;
}
button{
  width:100%;margin-top:10px;
  padding:12px;border:none;
  border-radius:10px;
  background:var(--accent);
  color:#fff;font-size:15px;
}
button.outline{background:#fff;color:var(--accent);border:1px solid var(--accent);}
.results-box{display:flex;gap:10px;flex-wrap:wrap;}
.results-box div{
  width:31%;background:#eef4ff;
  padding:12px;border-radius:10px;text-align:center;
}
.hidden{display:none;}
table{width:100%;border-collapse:collapse;font-size:13px;}
th,td{padding:7px;border-bottom:1px solid #ddd;}
th{background:#f2f5ff;position:sticky;top:0;}
.table-wrapper{max-height:250px;overflow:auto;}
.small-row{display:flex;gap:6px;margin-bottom:8px;}
.small-row input{flex:1;}
</style>
</head>

<body>
<div class="container">

<h1>EMI Calculator</h1>

<!-- BASIC -->
<div class="card">
  <div class="form-row">
    <label>Loan Amount (₹)</label>
    <input id="principal" type="number">
  </div>
  <div class="form-row">
    <label>Interest Rate (%)</label>
    <input id="rate" type="number">
  </div>
  <div class="form-row">
    <label>Tenure (Years)</label>
    <input id="years" type="number">
  </div>

  <button onclick="calculateEMI()">Calculate EMI</button>
  <button class="outline" onclick="clearAll()">Clear</button>
</div>

<!-- RESULTS -->
<div id="resultCard" class="card hidden">
  <div class="results-box">
    <div><b>EMI</b><br><span id="emi"></span></div>
    <div><b>Total Interest</b><br><span id="tInterest"></span></div>
    <div><b>Total Payment</b><br><span id="tPay"></span></div>
  </div>

  <canvas id="pieChart"></canvas>
  <canvas id="balChart" style="margin-top:20px;"></canvas>

  <h3>Amortization Schedule</h3>
  <div class="table-wrapper">
    <table>
      <thead>
        <tr><th>Month</th><th>EMI</th><th>Principal</th><th>Interest</th><th>Balance</th></tr>
      </thead>
      <tbody id="scheduleBody"></tbody>
    </table>
  </div>
</div>

<h2>Advanced Tools</h2>

<!-- LOAN COMPARISON -->
<div class="adv-box">
  <h3>Loan Comparison</h3>
  <div id="cmpContainer">
    <div class="small-row">
      <input placeholder="Label">
      <input type="number" placeholder="Principal">
      <input type="number" placeholder="Rate">
      <input type="number" placeholder="Years">
    </div>
  </div>
  <button onclick="addLoanRow()">+ Add Loan</button>
  <button onclick="compareLoans()">Compare</button>
  <div id="cmpResult"></div>
</div>

<!-- PART PAYMENT -->
<div class="adv-box">
  <h3>Part Payment</h3>
  <input id="pp_amount" type="number" placeholder="Lump Sum Amount">
  <input id="pp_month" type="number" placeholder="Apply at Month">
  <select id="pp_option">
    <option value="tenure">Reduce Tenure</option>
    <option value="emi">Reduce EMI</option>
  </select>
  <button onclick="applyPartPayment()">Apply</button>
  <div id="ppResult"></div>
</div>

<!-- TENURE REDUCTION TOOL -->
<div class="adv-box">
  <h3>Reduce Tenure by X Months</h3>
  <input id="targetMonths" type="number" placeholder="Months to reduce (1–12)">
  <button onclick="calculateRequiredLump()">Calculate Required Amount</button>
  <div id="tenureResult"></div>
</div>

</div>

<script>
let pieChart, balChart;

function calculateEMI(){
  let P=+principal.value;
  let R=+rate.value/12/100;
  let N=+years.value*12;
  if(P<=0||N<=0){alert("Enter valid values");return;}

  let emi=P*R*Math.pow(1+R,N)/(Math.pow(1+R,N)-1);
  let total=emi*N, interest=total-P;

  emiEl.innerText="₹"+emi.toFixed(2);
  tInterest.innerText="₹"+interest.toFixed(2);
  tPay.innerText="₹"+total.toFixed(2);

  generateSchedule(P,R,N,emi);
  drawCharts(P,interest,emi,R,N);

  resultCard.classList.remove("hidden");
}

function clearAll(){location.reload();}

function generateSchedule(P,R,N,emi){
  let bal=P, body="";
  for(let m=1;m<=N;m++){
    let i=bal*R;
    let p=emi-i;
    bal-=p;
    body+=`<tr><td>${m}</td><td>${emi.toFixed(2)}</td>
    <td>${p.toFixed(2)}</td><td>${i.toFixed(2)}</td>
    <td>${bal.toFixed(2)}</td></tr>`;
  }
  scheduleBody.innerHTML=body;
}

function drawCharts(P,I,emi,R,N){
  if(pieChart) pieChart.destroy();
  pieChart=new Chart(pieChartEl,{type:'pie',
    data:{labels:['Principal','Interest'],datasets:[{data:[P,I]}]}
  });

  let bal=P, arr=[];
  for(let i=0;i<N;i++){
    let inr=bal*R;
    bal-=emi-inr;
    arr.push(bal);
  }
  if(balChart) balChart.destroy();
  balChart=new Chart(balChartEl,{type:'line',
    data:{labels:arr.map((_,i)=>i+1),datasets:[{data:arr,label:'Balance'}]}
  });
}

function addLoanRow(){
  cmpContainer.innerHTML+=`
  <div class="small-row">
    <input placeholder="Label">
    <input type="number">
    <input type="number">
    <input type="number">
  </div>`;
}

function compareLoans(){
  let rows=document.querySelectorAll(".small-row");
  let html="<table><tr><th>Loan</th><th>EMI</th><th>Interest</th></tr>";
  rows.forEach(r=>{
    let P=+r.children[1].value;
    let R=+r.children[2].value/12/100;
    let N=+r.children[3].value*12;
    if(P>0&&N>0){
      let emi=P*R*Math.pow(1+R,N)/(Math.pow(1+R,N)-1);
      html+=`<tr><td>${r.children[0].value}</td>
      <td>${emi.toFixed(2)}</td>
      <td>${(emi*N-P).toFixed(2)}</td></tr>`;
    }
  });
  cmpResult.innerHTML=html+"</table>";
}

function applyPartPayment(){
  let P=+principal.value,R=+rate.value/12/100,N=+years.value*12;
  let emi=P*R*Math.pow(1+R,N)/(Math.pow(1+R,N)-1);
  let lump=+pp_amount.value,month=+pp_month.value;
  let bal=P;
  for(let i=1;i<month;i++) bal-=emi-bal*R;
  bal-=lump;

  let months=0,temp=bal;
  while(temp>0){
    temp-=emi-temp*R;
    months++;
  }
  let reduced=N-month-months;
  if(reduced<=0)
    ppResult.innerHTML="Amount too small. Increase lump sum.";
  else
    ppResult.innerHTML="Tenure reduced by "+reduced+" months";
}

function calculateRequiredLump(){
  let P=+principal.value,R=+rate.value/12/100,N=+years.value*12;
  let target=+targetMonths.value;
  let emi=P*R*Math.pow(1+R,N)/(Math.pow(1+R,N)-1);

  let low=0,high=P,ans=P;
  for(let i=0;i<40;i++){
    let mid=(low+high)/2;
    let bal=P-mid,months=0;
    while(bal>0){
      bal-=emi-bal*R;months++;
    }
    if(N-months>=target){ans=mid;high=mid;}
    else low=mid;
  }
  tenureResult.innerHTML="Required lump sum: ₹"+ans.toFixed(2);
}
</script>

</body>
</html>


